CREATE TABLE IF NOT EXISTS USERS_TABLE
(
    USER_ID  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL    VARCHAR(40) NOT NULL,
    LOGIN    VARCHAR(40) NOT NULL,
    NAME     VARCHAR(40),
    BIRTHDAY DATE
    );


CREATE TABLE IF NOT EXISTS TABLE_FILMS
(
    FILM_ID      INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME         VARCHAR(255),
    DESCRIPTION  VARCHAR(255),
    RELEASE_DATE DATE,
    DURATION     VARCHAR(10),
    MPA_ID      INTEGER REFERENCES MPA (id),
    GENRES_ID    INTEGER REFERENCES GENRES (id)
    );

CREATE TABLE IF NOT EXISTS TABLE_MPA
(
    MPA_ID  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME    VARCHAR
);

CREATE TABLE IF NOT EXISTS TABLE_GENRES
(
    GENRES_ID  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    NAME    VARCHAR NOT NULL
);


CREATE TABLE IF NOT EXISTS FRIENDSHIP (
 id    BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
 user_id    BIGINT REFERENCES users_table (user_id) ON DELETE CASCADE,
 friend_id  BIGINT REFERENCES users_table (user_id) ON DELETE CASCADE,
 UNIQUE (user_id, friend_id)
 );

CREATE TABLE IF NOT EXISTS LIKES
(
    likes_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id INTEGER REFERENCES users_table ( user_id) ON DELETE CASCADE,
    film_id INTEGER REFERENCES table_films ( film_id) ON DELETE CASCADE
    );

CREATE TABLE IF NOT EXISTS FILMS_GENRES
(
    FILM_ID  BIGINT NOT NULL,
    GENRES_ID INT    NOT NULL,
    CONSTRAINT FILMS_GENRES_PK PRIMARY KEY (FILM_ID, GENRES_ID),
    CONSTRAINT FILMS_GENRES_FK_1 FOREIGN KEY (FILM_ID) REFERENCES TABLE_FILMS (FILM_ID) ON DELETE CASCADE ON UPDATE CASCADE ,
    CONSTRAINT FILMS_GENRES_FK_2 FOREIGN KEY (GENRES_ID) REFERENCES TABLE_GENRES (GENRES_ID) ON DELETE CASCADE ON UPDATE CASCADE
    );


